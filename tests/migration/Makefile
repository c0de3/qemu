#
# Copyright (c) 2018 Red Hat, Inc. and/or its affiliates
#
# This work is licensed under the terms of the GNU GPL, version 2 or later.
# See the COPYING file in the top-level directory.
#

TARGET_LIST = x86_64 aarch64

SRC_PATH = ../..

override define __note
/* This file is automatically generated from the assembly file in
 * tests/migration/$@, edit that and then run "make all"
 * inside tests/migration to update, and then remember to send both
 * in your patch submission.
 */
endef
export __note

parse-cross-prefix = $(subst gcc,,$(patsubst cc,gcc,$(patsubst CROSS_CC_GUEST="%",%,$(shell grep "CROSS_CC_GUEST=" $(SRC_PATH)/$(1)-softmmu/config-target.mak))))
gen-cross-prefix = $(patsubst %-,CROSS_PREFIX=%-,$(call parse-cross-prefix,$(1)))

.PHONY: all $(TARGET_LIST)

all: $(TARGET_LIST)

$(TARGET_LIST):
	$(MAKE) -C $@ $(call gen-cross-prefix,$@)

clean:
	for target in $(TARGET_LIST); do \
		$(MAKE) -C $$target clean; \
	done
