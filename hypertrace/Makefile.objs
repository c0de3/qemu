# -*- mode: makefile -*-

target-obj-$(CONFIG_USER_ONLY) += user.o
ifdef CONFIG_PCI
target-obj-$(CONFIG_SOFTMMU) += softmmu.o
endif

$(obj)/user.o $(obj)/softmmu.o: $(obj)/emit.c

$(obj)/emit.c: $(obj)/emit.c-timestamp $(BUILD_DIR)/config-host.mak
	@cmp $< $@ >/dev/null 2>&1 || cp $< $@
$(obj)/emit.c-timestamp: $(BUILD_DIR)/config-host.mak
	@echo "static void hypertrace_emit(CPUState *cpu, uint64_t *data)" >$@
	@echo "{" >>$@
	@echo -n "    trace_guest_hypertrace(cpu" >>$@
	@for i in `seq $(CONFIG_HYPERTRACE_ARGS)`; do \
	    echo -n ", data[$$i-1]" >>$@; \
	done
	@echo ");" >>$@
	@echo "}" >>$@
